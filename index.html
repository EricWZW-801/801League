<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>801.LEAGUE èµ›äº‹ç³»ç»Ÿ v0.73</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Noto+Serif+SC:wght@700;900&family=Ma+Shan+Zheng&family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --bg-color: #080a10;
            --panel-bg: #11141d;
            --panel-border: #232936;
            --primary-gold: #cfaa68;
            --primary-gold-dim: #8a7346;
            --danger-red: #d50000;
            --text-white: #ffffff;
            --text-gray: #7d859e;
            --rank-1-bg: #cfaa68;
            --rank-2-bg: #8b9bb4;
            --rank-3-bg: #a05e46;
            --rank-4-bg: #4a5568;
            --font-head: 'Oswald', sans-serif;
            --font-num: 'JetBrains Mono', monospace;
            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-serif: 'Noto Serif SC', serif;
            --font-calligraphy: 'Ma Shan Zheng', cursive;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 0%, #1a1f2e 0%, transparent 70%);
            color: var(--text-white);
            margin: 0;
            padding: 20px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* --- Header (V0.73 Updated) --- */
        .header { text-align: center; margin-bottom: 25px; position: relative; padding-bottom: 15px; width: 100%; }
        .header::after {
            content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 60px; height: 3px; background: var(--primary-gold); box-shadow: 0 0 10px var(--primary-gold-dim);
        }
        .header h1 { 
            margin: 0; font-family: var(--font-head); font-style: italic; font-weight: 700; 
            font-size: 2.5rem; letter-spacing: 1px; text-transform: uppercase;
            background: linear-gradient(180deg, #fff 0%, #ccc 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        /* V0.73 Organizer Name */
        .organizer { color: var(--primary-gold); font-family: var(--font-head); font-size: 0.9rem; margin-top: 5px; letter-spacing: 1px; font-weight: 500; }
        .header .meta-row { display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 5px; }
        .subtitle { color: var(--text-gray); font-family: var(--font-head); font-size: 0.75rem; letter-spacing: 2px; text-transform: uppercase; }
        .version-badge {
            background: rgba(207, 170, 104, 0.15); border: 1px solid var(--primary-gold-dim);
            color: var(--primary-gold); font-family: var(--font-num); font-size: 0.7rem;
            padding: 2px 6px; border-radius: 4px; font-weight: bold;
        }

        /* --- Tab/Menu --- */
        .nav-tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        .nav-btn {
            background: #1a1f2e; border: 1px solid #333; color: #888; padding: 8px 16px; 
            border-radius: 20px; font-size: 0.8rem; cursor: pointer; transition: 0.2s; white-space: nowrap;
        }
        .nav-btn.active { background: var(--primary-gold); color: #000; font-weight: bold; border-color: var(--primary-gold); }
        .nav-btn.active-danger { background: var(--danger-red); color: #fff; font-weight: bold; border-color: var(--danger-red); }

        /* --- Input Card --- */
        .input-card {
            background: var(--panel-bg); padding: 25px 20px; border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6); width: 100%; max-width: 550px;
            margin-bottom: 30px; border: 1px solid var(--panel-border); position: relative; overflow: hidden;
            box-sizing: border-box; display: none;
        }
        .input-card.active { display: block; }
        .input-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, transparent, var(--primary-gold), transparent); opacity: 0.5;
        }
        .input-card.penalty-mode::before { background: linear-gradient(90deg, transparent, var(--danger-red), transparent); }

        .player-row { display: grid; grid-template-columns: 30px 1.5fr 1fr; gap: 10px; margin-bottom: 15px; align-items: center; }
        .wind-label { font-family: var(--font-head); font-weight: 500; color: var(--primary-gold); text-align: center; font-size: 1.2rem; }
        
        input, select {
            background: #0b0e14; border: 1px solid #2a2f40; color: #fff; padding: 12px;
            border-radius: 8px; font-size: 1rem; width: 100%; box-sizing: border-box;
            transition: all 0.3s; font-family: var(--font-body);
        }
        input:focus, select:focus { outline: none; border-color: var(--primary-gold); background: #12151f; box-shadow: 0 0 15px rgba(207, 170, 104, 0.15); }
        input[type="number"] { font-family: var(--font-num); font-weight: 700; letter-spacing: 1px; }

        .btn-group { display: flex; gap: 10px; margin-top: 25px; }
        button {
            flex: 1; padding: 14px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;
            text-transform: uppercase; font-family: var(--font-head); font-size: 0.95rem; letter-spacing: 1px;
            transition: 0.2s;
        }
        .btn-submit { background: linear-gradient(135deg, #cfaa68 0%, #aa8949 100%); color: #1a1a1a; box-shadow: 0 4px 20px rgba(207, 170, 104, 0.25); }
        .btn-reset { background: #232936; color: #7d859e; border: 1px solid #2a2f40; }
        .btn-penalty { background: linear-gradient(135deg, #d50000 0%, #9b0000 100%); color: #fff; box-shadow: 0 4px 20px rgba(213, 0, 0, 0.3); }

        .form-stack { display: flex; flex-direction: column; gap: 15px; }
        .form-tip { font-size: 0.75rem; color: #666; margin-top: -10px; padding-left: 5px; }
        .status-bar { text-align: center; font-size: 0.85rem; margin: 20px 0; padding: 10px; border-radius: 8px; font-weight: bold; background: rgba(0,0,0,0.3); }
        .status-ok { color: #4dff88; background: rgba(77, 255, 136, 0.05); }

        /* --- Tables Container --- */
        #tables-container { display: block; width: 100%; max-width: 600px; }

        .section-title { width: 100%; margin: 30px 0 10px 0; display: flex; justify-content: space-between; align-items: center; }
        .section-title span { font-family: var(--font-head); font-size: 1.1rem; font-weight: 700; color: var(--text-white); border-left: 4px solid var(--primary-gold); padding-left: 10px; letter-spacing: 1px; }
        .action-btn { padding: 5px 10px; font-size: 0.7rem; border-radius: 4px; border: 1px solid #333; cursor: pointer; background: #1a1f2e; color: #888; }
        .btn-danger { color: #ff6b6b; border-color: #522; }

        table { width: 100%; border-collapse: separate; border-spacing: 0; background-color: var(--panel-bg) !important; border-radius: 12px; overflow: hidden; border: 1px solid var(--panel-border); color: #fff !important; }
        th { background-color: #1a1f2e !important; color: var(--text-gray) !important; padding: 12px; font-size: 0.7rem; font-family: var(--font-head); border-bottom: 1px solid var(--panel-border); }
        td { background-color: var(--panel-bg) !important; color: #fff !important; padding: 12px; text-align: center; border-bottom: 1px solid #232936; font-family: var(--font-num); font-size: 0.85rem; }
        .score-plus { color: #fff !important; } .score-minus { color: #6a768f !important; }

        .history-row { cursor: pointer; transition: background 0.2s; }
        .history-row:hover td { background-color: #1f2536 !important; }
        .history-detail-row { display: none; background-color: #0c0e14 !important; }
        .history-detail-row.show { display: table-row; }
        .detail-wrapper { padding: 15px; }
        .detail-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 15px; }
        .detail-item { display: flex; flex-direction: column; align-items: center; background: #161b26; padding: 10px 2px; border-radius: 6px; border: 1px solid #232936; }
        .d-rank { font-family: var(--font-head); font-weight: bold; color: var(--primary-gold); font-size: 0.9rem;}
        .d-name { color: #fff; font-size: 0.8rem; margin: 4px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; font-weight: bold; }
        .d-score { color: var(--text-gray); font-family: var(--font-num); font-size: 0.75rem; margin-bottom: 2px; }
        .d-pt { font-family: var(--font-num); font-weight: bold; font-size: 0.9rem; }
        .btn-regenerate { background: #232936; color: var(--primary-gold); border: 1px solid var(--primary-gold-dim); padding: 8px 20px; border-radius: 4px; font-size: 0.75rem; cursor: pointer; font-weight: bold; }

        /* Patch Notes */
        .patch-notes-container { width: 100%; max-width: 600px; margin-top: 30px; border-top: 1px solid #333; padding-top: 20px; }
        .patch-toggle { color: #555; font-size: 0.8rem; cursor: pointer; text-align: center; display: block; width: 100%; background: none; border: none; text-decoration: underline; }
        .patch-list { display: none; margin-top: 15px; background: #0f1118; padding: 15px; border-radius: 8px; border: 1px solid #222; }
        .patch-list.show { display: block; }
        .patch-item { margin-bottom: 10px; font-size: 0.75rem; color: #888; border-bottom: 1px dashed #222; padding-bottom: 5px; }
        .patch-ver { color: var(--primary-gold); font-weight: bold; margin-right: 5px; }

        .main-footer { margin-top: 20px; margin-bottom: 20px; color: #3c4357; font-size: 0.7rem; text-align: center; }

        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; justify-content: center; align-items: center; flex-direction: column; padding: 20px; overflow-y: auto; backdrop-filter: blur(5px); }
        .capture-wrapper { margin-bottom: 20px; box-shadow: 0 0 60px rgba(0,0,0,0.8); max-width: 100%; }
        .modal-btns { margin-top: 15px; display: flex; gap: 10px; flex-direction: column; align-items: center; }
        .btn-download { background: var(--primary-gold); color: #000; padding: 10px 30px; border-radius: 50px; font-weight: bold; font-family: var(--font-head); text-transform: uppercase; border: none; cursor: pointer; }
        .btn-close { background: transparent; border: 1px solid #555; color: #aaa; padding: 8px 30px; border-radius: 50px; cursor: pointer; font-size: 0.8rem; }
        #img-preview-area { margin-top: 15px; text-align: center; display: none; }
        #img-preview-area img { max-width: 100%; border: 1px solid #fff; border-radius: 4px; }
        .save-tip { color: #4dff88; font-size: 0.8rem; margin-bottom: 5px; }

        /* =========================================
           V0.73 Match Poster Optimized
           ========================================= */
        /* Increased width for better PT display */
        .share-card { width: 600px; max-width: 100%; background: #12151f; background-image: linear-gradient(rgba(18, 21, 31, 0.97), rgba(18, 21, 31, 0.97)), repeating-linear-gradient(45deg, #1f2536 0, #1f2536 1px, transparent 0, transparent 40px); border: 2px solid var(--primary-gold); border-radius: 6px; overflow: hidden; font-family: var(--font-body); position: relative; }
        .sc-header { background: linear-gradient(90deg, #080a10 0%, #1c2130 100%); display: flex; justify-content: space-between; align-items: flex-end; padding: 20px 30px; border-bottom: 1px solid var(--primary-gold); }
        .sc-title h2 { margin: 0; color: #fff; font-family: var(--font-head); font-style: italic; font-weight: 700; font-size: 2.2rem; }
        .sc-title span { color: var(--primary-gold); }
        .sc-meta { text-align: right; }
        .sc-game-id { color: var(--primary-gold); font-family: var(--font-head); font-weight: 700; font-size: 1.4rem; }
        .sc-date { color: var(--text-gray); font-family: var(--font-num); font-size: 0.75rem; }
        
        /* V0.73 Optimized Grid: Wider columns for PT */
        /* Columns: Rank(50) | Name(Auto) | Score(90) | PT(90) | Total(95) */
        .sc-labels, .sc-row { display: grid; grid-template-columns: 50px 1fr 90px 90px 95px; gap: 12px; align-items: center; padding: 0 25px; }
        .sc-labels { padding-top: 12px; padding-bottom: 8px; background: rgba(255,255,255,0.02); font-family: var(--font-head); font-size: 0.65rem; color: #5d6680; text-transform: uppercase; letter-spacing: 1px; }
        .sc-row { background: rgba(255,255,255,0.03); margin: 0 25px 8px 25px; border-radius: 4px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); height: 60px; padding: 0; }
        
        .lbl-right { text-align: right; } .lbl-right.highlight { color: var(--primary-gold); opacity: 0.9; }
        
        /* V0.73 Improved Rank Badge Contrast */
        .sc-rank-badge { height: 100%; display: flex; align-items: center; justify-content: center; font-family: var(--font-head); font-weight: 700; font-style: italic; font-size: 1.6rem; color: rgba(255,255,255,0.5); background: #2a2f40; }
        .sc-row.r1 { background: linear-gradient(90deg, rgba(207, 170, 104, 0.2) 0%, transparent 100%); border-color: var(--rank-1-bg); }
        .sc-row.r1 .sc-rank-badge { background: var(--rank-1-bg); color: #000; border-right: 2px solid #fff; box-shadow: 2px 0 5px rgba(0,0,0,0.3); }
        .sc-row.r2 { background: linear-gradient(90deg, rgba(139, 155, 180, 0.2) 0%, transparent 100%); border-color: var(--rank-2-bg); }
        .sc-row.r2 .sc-rank-badge { background: var(--rank-2-bg); color: #000; border-right: 2px solid #fff; box-shadow: 2px 0 5px rgba(0,0,0,0.3); }
        .sc-row.r3 { background: linear-gradient(90deg, rgba(160, 94, 70, 0.2) 0%, transparent 100%); border-color: var(--rank-3-bg); }
        .sc-row.r3 .sc-rank-badge { background: var(--rank-3-bg); color: #000; border-right: 2px solid #fff; box-shadow: 2px 0 5px rgba(0,0,0,0.3); }
        .sc-row.r4 .sc-rank-badge { background: var(--rank-4-bg); color: #fff; opacity: 0.7; }

        .sc-name { font-family: var(--font-body); font-weight: 700; color: #fff; font-size: 1.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-left: 10px; }
        .sc-val { font-family: var(--font-num); text-align: right; padding-right: 5px; }
        .sc-score { color: var(--text-gray); font-size: 0.95rem; }
        .sc-pt { font-weight: 800; font-size: 1.2rem; }
        .sc-total { font-weight: 700; color: var(--primary-gold); border-left: 1px solid #444; font-size: 1rem; padding-left: 10px; }
        .val-pos { color: #fff; text-shadow: 0 0 8px rgba(255,255,255,0.3); } .val-neg { color: #6a768f; }
        .sc-footer { background: linear-gradient(to bottom, #141824, #000); color: #aab; text-align: center; font-size: 0.65rem; padding: 15px 12px; letter-spacing: 4px; font-family: "Noto Serif SC", serif; font-weight: 700; border-top: 1px solid #333; text-shadow: 0 1px 2px rgba(0,0,0,0.8); text-transform: uppercase; }

        /* V0.73 Mobile Grid Adjustments */
        @media screen and (max-width: 550px) {
            .share-card { width: 360px; } /* Slightly wider mobile card */
            .sc-header { padding: 15px; } .sc-title h2 { font-size: 1.8rem; }
            /* Tighter columns but enough for data */
            .sc-labels, .sc-row { grid-template-columns: 35px 1fr 60px 60px 65px; gap: 5px; padding-left: 0; padding-right: 0; }
            .sc-row { margin: 0 10px 8px 10px; } .sc-labels { padding: 10px 10px 5px 10px; }
            .sc-name { font-size: 0.9rem; } .sc-rank-badge { font-size: 1.3rem; }
            .sc-score { font-size: 0.8rem; } .sc-pt { font-size: 0.95rem; } .sc-total { font-size: 0.85rem; padding-left: 5px; }
        }

        /* Yakuman Certificate (Realistic) */
        .cert-card {
            width: 800px; max-width: 100%;
            background: #0d0d0d; border: 4px double var(--primary-gold); padding: 40px; position: relative; text-align: center;
            font-family: "Noto Serif SC", serif; color: #fff; display: flex; flex-direction: column; align-items: center;
        }
        .cert-bg-logo { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: var(--font-head); font-size: 12rem; opacity: 0.03; color: var(--primary-gold); font-weight: 900; pointer-events: none; }
        .cert-header { font-size: 3rem; color: var(--primary-gold); margin-bottom: 20px; letter-spacing: 10px; text-shadow: 0 0 15px rgba(207, 170, 104, 0.4); border-bottom: 1px solid #333; padding-bottom: 10px; width: 100%; }
        .cert-content { width: 100%; z-index: 1; }
        .cert-text { font-size: 1.2rem; color: #aaa; margin: 10px 0; letter-spacing: 2px; }
        .cert-player { font-size: 2.5rem; color: #fff; font-weight: 900; margin: 5px 0 15px 0; text-decoration: underline; text-decoration-color: var(--primary-gold); }
        .cert-yakuman-name { 
            font-size: 4rem; color: var(--primary-gold); font-weight: 900; margin: 15px 0; 
            text-shadow: 0 5px 15px rgba(0,0,0,0.8); letter-spacing: 5px;
            background: linear-gradient(180deg, #fff 0%, #cfaa68 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .cert-tiles { display: flex; gap: 4px; justify-content: center; margin: 35px 0; flex-wrap: wrap; perspective: 600px; }
        .real-tile {
            width: 48px; height: 66px; background: linear-gradient(145deg, #fffdf5 0%, #eee8d5 100%); border-radius: 6px; position: relative;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.9), 0 6px 0 #d9a046, 0 10px 8px rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center; font-size: 42px; line-height: 1; transform: rotateX(5deg); margin-bottom: 6px; z-index: 1;
        }
        .real-tile::after { content: ""; position: absolute; top: 0; left: 0; right: 0; height: 40%; background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(255,255,255,0.0)); border-radius: 6px 6px 30% 30%; pointer-events: none; }
        .real-tile.man { color: #b91e2e; text-shadow: 0 1px 0 rgba(255,255,255,0.5); } .real-tile.pin { color: #224475; text-shadow: 0 1px 0 rgba(255,255,255,0.5); } .real-tile.sou { color: #1a6840; text-shadow: 0 1px 0 rgba(255,255,255,0.5); }
        .real-tile.honor { color: #000; text-shadow: 0 1px 0 rgba(255,255,255,0.5); } .real-tile.red { color: #d50000; text-shadow: 0 1px 0 rgba(255,255,255,0.5); } .real-tile.green { color: #1b5e20; text-shadow: 0 1px 0 rgba(255,255,255,0.5); }
        .cert-footer { margin-top: 30px; display: flex; flex-direction: column; align-items: flex-end; width: 100%; text-align: right; }
        .cert-org { font-size: 1.1rem; font-weight: bold; color: #fff; position: relative; margin-right: 20px; }
        .cert-seal-box {
            position: absolute; top: -40px; right: -20px; width: 100px; height: 100px;
            border: 4px solid #b71c1c; border-radius: 4px; color: #b71c1c; display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-family: var(--font-calligraphy), serif; font-size: 1.5rem; line-height: 1.1; transform: rotate(-8deg); opacity: 0.85; mix-blend-mode: screen;
            box-shadow: 0 0 0 2px rgba(183, 28, 28, 0.2); background: rgba(183, 28, 28, 0.05);
        }
        .cert-seal-text { font-weight: bold; letter-spacing: 2px; }

        /* Penalty Card (V0.73 Highlighted Timestamp) */
        .penalty-card {
            width: 600px; max-width: 100%;
            background: #0a0000; border: 2px solid #500; border-top: 8px solid #d50000;
            padding: 40px; text-align: center; font-family: "Noto Serif SC", serif; color: #fff;
            position: relative; overflow: hidden;
            background-image: repeating-linear-gradient(45deg, #100 0, #100 2px, #000 0, #000 10px);
        }
        .penalty-watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-30deg); font-size: 8rem; color: #d50000; opacity: 0.1; font-weight: 900; border: 5px solid #d50000; padding: 10px 40px; }
        .penalty-title { font-size: 3rem; color: #d50000; font-weight: 900; margin-bottom: 30px; text-transform: uppercase; letter-spacing: 5px; text-shadow: 0 0 10px #500; border-bottom: 2px solid #333; padding-bottom: 20px; }
        .penalty-content { font-size: 1.3rem; line-height: 1.8; color: #ddd; margin: 20px 0; z-index: 1; position: relative; }
        .penalty-player { color: #fff; font-size: 1.8rem; font-weight: bold; text-decoration: underline; text-decoration-color: #d50000; }
        .penalty-reason { color: #f55; font-weight: bold; }
        .penalty-result { margin-top: 20px; padding: 15px; background: rgba(213, 0, 0, 0.1); border-left: 5px solid #d50000; color: #fff; font-weight: bold; font-size: 1.4rem; }
        /* V0.73 Prominent Timestamp */
        .penalty-time.highlighted {
            margin: 20px auto; display: inline-block;
            padding: 5px 15px;
            background: #d50000; color: #fff;
            font-family: var(--font-num); font-weight: bold; font-size: 0.9rem;
            border-radius: 4px; letter-spacing: 1px;
            box-shadow: 0 2px 10px rgba(213,0,0,0.3);
        }
        .penalty-footer { margin-top: 30px; font-size: 0.9rem; color: #666; text-align: center; }

    </style>
</head>
<body>

    <div class="header">
        <h1>801.LEAGUE</h1>
        <div class="organizer">Presented by é»„åŸ”é³„éœ¸801</div>
        <div class="meta-row">
            <div class="subtitle">OFFICIAL MATCH RECORDER</div>
            <div class="version-badge">v0.73</div>
        </div>
    </div>

    <div class="nav-tabs">
        <button class="nav-btn active" onclick="switchTab('match')" id="btn-tab-match">æ¯”èµ›è®°å½•</button>
        <button class="nav-btn" onclick="switchTab('yakuman')" id="btn-tab-yakuman">å½¹æ»¡è¯ä¹¦</button>
        <button class="nav-btn" onclick="switchTab('penalty')" id="btn-tab-penalty">å¤„ç½šé»‘æ¦œ</button>
    </div>

    <div id="tab-match" class="input-card active">
        <div class="player-row">
            <div class="wind-label">ä¸œ</div>
            <input type="text" id="p1-name" placeholder="ID" list="history-names" autocomplete="off">
            <input type="number" id="p1-score" placeholder="å¾—åˆ†" oninput="checkSum()" step="100" autocomplete="off">
        </div>
        <div class="player-row">
            <div class="wind-label">å—</div>
            <input type="text" id="p2-name" placeholder="ID" list="history-names" autocomplete="off">
            <input type="number" id="p2-score" placeholder="å¾—åˆ†" oninput="checkSum()" step="100" autocomplete="off">
        </div>
        <div class="player-row">
            <div class="wind-label">è¥¿</div>
            <input type="text" id="p3-name" placeholder="ID" list="history-names" autocomplete="off">
            <input type="number" id="p3-score" placeholder="å¾—åˆ†" oninput="checkSum()" step="100" autocomplete="off">
        </div>
        <div class="player-row">
            <div class="wind-label">åŒ—</div>
            <input type="text" id="p4-name" placeholder="ID" list="history-names" autocomplete="off">
            <input type="number" id="p4-score" placeholder="å¾—åˆ†" oninput="checkSum()" step="100" autocomplete="off">
        </div>
        
        <div id="status-bar" class="status-bar status-ok">ç­‰å¾…è¾“å…¥åˆ†æ•°...</div>

        <div class="btn-group">
            <button class="btn-submit" onclick="submitMatch()">è®°å½• & ç”Ÿæˆæˆ˜æŠ¥</button>
            <button class="btn-reset" onclick="resetInputs()">é‡ç½®</button>
        </div>
    </div>

    <div id="tab-yakuman" class="input-card">
        <div class="form-stack">
            <input type="text" id="y-name" placeholder="å’Œç‰Œé€‰æ‰‹ ID" list="history-names">
            <input type="text" id="y-hand" placeholder="æ‰‹ç‰Œä»£ç  (å¦‚: 123m 456p 789s eswn pfc)">
            <div class="form-tip">ä»£ç : æ•°å­—+mps(ä¸‡é¥¼æ¡), eswn(ä¸œå—è¥¿åŒ—), P/bai(ç™½), f(å‘), c(ä¸­)</div>
            <div style="display:flex; gap:10px;">
                <select id="y-type" style="flex:1;"><option value="è£å’Œ">è£å’Œ</option><option value="è‡ªæ‘¸">è‡ªæ‘¸</option></select>
                <select id="y-yaku" style="flex:2;">
                    <option value="å›½å£«æ— åŒ">å›½å£«æ— åŒ</option><option value="å››æš—åˆ»">å››æš—åˆ»</option>
                    <option value="å¤§ä¸‰å…ƒ">å¤§ä¸‰å…ƒ</option><option value="å­—ä¸€è‰²">å­—ä¸€è‰²</option>
                    <option value="ç»¿ä¸€è‰²">ç»¿ä¸€è‰²</option><option value="æ¸…è€å¤´">æ¸…è€å¤´</option>
                    <option value="å°å››å–œ">å°å››å–œ</option><option value="å¤§å››å–œ">å¤§å››å–œ</option>
                    <option value="å››æ å­">å››æ å­</option><option value="ä¹è²å®ç¯">ä¹è²å®ç¯</option>
                    <option value="å›½å£«æ— åŒåä¸‰é¢">å›½å£«æ— åŒåä¸‰é¢</option><option value="çº¯æ­£ä¹è²å®ç¯">çº¯æ­£ä¹è²å®ç¯</option>
                    <option value="å››æš—åˆ»å•éª‘">å››æš—åˆ»å•éª‘</option><option value="ç´¯è®¡å½¹æ»¡">ç´¯è®¡å½¹æ»¡</option>
                </select>
            </div>
            <button class="btn-submit" onclick="generateCertificate()">ç”Ÿæˆå½¹æ»¡è¯ä¹¦</button>
        </div>
    </div>

    <div id="tab-penalty" class="input-card penalty-mode">
        <div class="form-stack">
            <input type="text" id="pen-name" placeholder="è¿è§„é€‰æ‰‹ ID" list="history-names">
            
            <select id="pen-reason">
                <option value="" disabled selected>é€‰æ‹©è¿è§„åŸå› </option>
                <option value="æŒ¯å¬è£å’Œ">æŒ¯å¬è£å’Œ (Furiten Ron)</option>
                <option value="é”™å’Œ">é”™å’Œ (False Ron)</option>
                <option value="è™šç«‹ç›´">è™šç«‹ç›´ (False Riichi)</option>
                <option value="ç ´åç‰Œå±±">ç ´åç‰Œå±±</option>
                <option value="å°‘ç‰Œ/å¤šç‰Œ">å°‘ç‰Œ/å¤šç‰Œ (Wrong Tile Count)</option>
                <option value="è¯¯å‘å£°">è¯¯å‘å£°</option>
                <option value="æœªæ³¨æ„ç‰Œæ¡Œç¤¼ä»ª">æœªæ³¨æ„ç‰Œæ¡Œç¤¼ä»ª</option>
                <option value="ä½œå¼Šè¡Œä¸º">ä½œå¼Šè¡Œä¸º (Cheating)</option>
                <option value="æ¶åŠ£è¨€è¡Œ">æ¶åŠ£è¨€è¡Œ</option>
            </select>
            
            <select id="pen-result">
                <option value="" disabled selected>é€‰æ‹©å¤„ç½šç»“æœ</option>
                <option value="é»„ç‰Œè­¦å‘Š">é»„ç‰Œè­¦å‘Š (Yellow Card)</option>
                <option value="çº¢ç‰Œ - æ‰£é™¤12pt">çº¢ç‰Œ - æ‰£é™¤12pt (Red Card)</option>
                <option value="æœ¬å±€åœå’Œ">æœ¬å±€åœå’Œ (Dead Hand)</option>
                <option value="é”™å’Œç½šç¬¦">é”™å’Œç½šç¬¦ (Chombo Payment)</option>
                <option value="æ‰£é™¤ 8pt">æ‰£é™¤ 8pt</option>
                <option value="æ‰£é™¤ 12pt">æ‰£é™¤ 12pt</option>
                <option value="æ‰£é™¤ 20pt">æ‰£é™¤ 20pt</option>
                <option value="æ‰£é™¤å½“æ—¥ç§¯åˆ†">æ‰£é™¤å½“æ—¥ç§¯åˆ†</option>
                <option value="æš‚åœæ¯”èµ›èµ„æ ¼">æš‚åœæ¯”èµ›èµ„æ ¼</option>
                <option value="æ°¸ä¹…ç¦èµ›">æ°¸ä¹…ç¦èµ›</option>
            </select>

            <button class="btn-submit btn-penalty" onclick="generatePenalty()">ç”Ÿæˆå¤„ç½šé€šå‘Š</button>
        </div>
    </div>

    <datalist id="history-names"></datalist>

    <div id="tables-container">
        <div class="section-title">
            <span>ğŸ† SEASON RANKING</span>
            <button class="action-btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰</button>
        </div>
        <table id="leaderboard-table">
            <thead>
                <tr>
                    <th style="width:15%">Rank</th>
                    <th style="text-align:left">Player</th>
                    <th>GAMES</th>
                    <th>Total PT</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="section-title">
            <span>ğŸ“œ MATCH HISTORY</span>
            <button class="action-btn btn-warn" id="undo-btn" onclick="undoLastMatch()" style="display:none;">â†©ï¸ æ’¤é”€ä¸Šä¸€å±€</button>
        </div>
        <table id="history-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>1st</th>
                    <th>2nd</th>
                    <th>3rd</th>
                    <th>4th</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div style="font-size:0.75rem; color:#555; text-align:center; margin-top:8px; font-family:var(--font-body);">ç‚¹å‡»è®°å½•å¯æŸ¥çœ‹è¯¦æƒ…æˆ–ç”Ÿæˆæµ·æŠ¥</div>
    </div>

    <div class="modal-overlay" id="share-modal">
        <div class="capture-wrapper" id="capture-target">
            
            <div class="share-card" id="match-poster-dom" style="display:none;">
                <div class="sc-header">
                    <div class="sc-title"><h2>801<span>.LEAGUE</span></h2></div>
                    <div class="sc-meta"><div class="sc-game-id" id="share-game-id">GAME #00</div><div class="sc-date" id="share-date">--.--.--</div></div>
                </div>
                <div class="sc-labels"><div class="lbl-center">#</div><div class="lbl-left">PLAYER</div><div class="lbl-right">SCORE</div><div class="lbl-right">PT</div><div class="lbl-right highlight">TOTAL</div></div>
                <div class="sc-body" id="share-content"></div>
                <div class="sc-footer">é»„åŸ”é³„éœ¸801æ—¥éº»ç§¯åˆ†ç³»ç»Ÿ</div>
            </div>

            <div class="cert-card" id="yakuman-cert-dom" style="display:none;">
                <div class="cert-bg-logo">801</div>
                <div class="cert-header">å½¹æ»¡è¯ä¹¦</div>
                <div class="cert-content">
                    <div class="cert-text">æ­å–œé€‰æ‰‹</div>
                    <div class="cert-player" id="cert-name">PlayerID</div>
                    <div class="cert-text"><span id="cert-date">2023.10.01</span> äº 801.League ä¸­</div>
                    <div class="cert-text" style="font-weight:bold; color:#fff;">ã€ <span id="cert-type">è‡ªæ‘¸</span> ã€‘ å’Œç‰Œ</div>
                    <div class="cert-yakuman-name" id="cert-yaku">å›½å£«æ— åŒ</div>
                    <div class="cert-tiles" id="cert-tiles-container"></div>
                </div>
                <div class="cert-footer">
                    <div class="cert-org">é»„åŸ”é³„éœ¸801<br>ç«‹ç›´éº»å°†ç«èµ›ç®¡ç†å°ç»„
                        <div class="cert-seal-box"><div class="cert-seal-text">801<br>è®¤è¯</div></div>
                    </div>
                </div>
            </div>

            <div class="penalty-card" id="penalty-dom" style="display:none;">
                <div class="penalty-watermark">VIOLATION</div>
                <div class="penalty-title">è¿è§„å¤„ç½šé€šå‘Š</div>
                <div class="penalty-content">
                    <p>åœ¨ <strong>801.League</strong> æ¯”èµ›ä¸­</p>
                    <p>é€‰æ‰‹ <span class="penalty-player" id="pen-dom-name">ID</span></p>
                    <p>å›  <span class="penalty-reason" id="pen-dom-reason">è¿è§„åŸå› </span></p>
                    <div class="penalty-result">
                        å¤„ç†ç»“æœï¼š<span id="pen-dom-result">å¤„ç½šç»“æœ</span>
                    </div>
                    <div class="penalty-time highlighted" id="pen-dom-time">TIME</div>
                    <p style="margin-top:20px; font-size:1rem;">æœ›å„ä½é€‰æ‰‹å¼•ä»¥ä¸ºæˆ’ï¼Œéµå®ˆæ¯”èµ›è§„åˆ™ï¼Œ<br>å…±åŒç»´æŠ¤è‰¯å¥½çš„ç«æŠ€ç¯å¢ƒã€‚</p>
                </div>
                <div class="penalty-footer">é»„åŸ”é³„éœ¸801ç«‹ç›´éº»å°†ç«èµ›ç®¡ç†å°ç»„</div>
            </div>

        </div>

        <div class="modal-btns" id="modal-controls">
            <button class="btn-download" onclick="downloadImage()">ğŸ“¸ ä¿å­˜ä¸ºå›¾ç‰‡</button>
            <button class="btn-close" onclick="closeModal()">å…³é—­</button>
        </div>
        <div id="img-preview-area"><div class="save-tip">âœ… ç”ŸæˆæˆåŠŸï¼è¯·é•¿æŒ‰ä¸‹æ–¹å›¾ç‰‡ä¿å­˜</div></div>
    </div>

    <div class="patch-notes-container">
        <button class="patch-toggle" onclick="togglePatchNotes()">ğŸ“ æŸ¥çœ‹ç‰ˆæœ¬æ›´æ–°æ—¥å¿— (Patch Notes)</button>
        <div class="patch-list" id="patch-list">
            <div class="patch-item"><span class="patch-ver">v0.73</span> ä¼˜åŒ–æµ·æŠ¥æ’ç‰ˆä¸å¯¹æ¯”åº¦ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ˜¾ç¤ºï¼›é¡µçœ‰å¢åŠ å‘èµ·æ–¹ï¼›å¤„ç½šè¯ä¹¦æ—¶é—´æˆ³é«˜äº®å¹¶å±…ä¸­ï¼›æ–°å¢é»„ç‰Œ/çº¢ç‰Œå¤„ç½šé€‰é¡¹ã€‚</div>
            <div class="patch-item"><span class="patch-ver">v0.72+</span> ä¼˜åŒ–éº»å°†ç‰Œä¸ºæ‹ŸçœŸ3Dè´¨æ„Ÿï¼›å¤„ç½šè¯ä¹¦æ–°å¢ç²¾ç¡®æ—¶é—´æˆ³ï¼›ä¿®å¤æ•°æ®åˆå§‹åŒ–é—®é¢˜ã€‚</div>
            <div class="patch-item"><span class="patch-ver">v0.71</span> æ–°å¢é»‘æ¦œå¤„ç½šç”Ÿæˆå™¨ï¼›å°ç« æ ·å¼æ›´æ–°ã€‚</div>
        </div>
    </div>

    <script>
        const RULE = { base: 30000, uma: [30, 10, -10, -30], oka: 20 };
        let appData = { matches: [], players: {} };
        let currentMode = 'match'; 

        window.onload = function() { loadData(); updateUI(); };

        function switchTab(tab) {
            currentMode = tab;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active', 'active-danger'));
            document.querySelectorAll('.input-card').forEach(c => c.classList.remove('active'));
            
            document.getElementById('btn-tab-'+tab).classList.add(tab==='penalty'?'active-danger':'active');
            document.getElementById('tab-'+tab).classList.add('active');
        }

        function togglePatchNotes() { document.getElementById('patch-list').classList.toggle('show'); }
        function loadData() { const s = localStorage.getItem('801_league_data_v7'); if (s) appData = JSON.parse(s); refreshNameList(); }
        function saveData() { localStorage.setItem('801_league_data_v7', JSON.stringify(appData)); refreshNameList(); }
        function refreshNameList() {
             const dl = document.getElementById('history-names'); dl.innerHTML='';
             Object.keys(appData.players).forEach(n=>{let o=document.createElement('option');o.value=n;dl.appendChild(o)});
        }

        // --- Logic: Match ---
        function checkSum() {
            const s1 = Number(document.getElementById('p1-score').value)||0, s2 = Number(document.getElementById('p2-score').value)||0, s3 = Number(document.getElementById('p3-score').value)||0, s4 = Number(document.getElementById('p4-score').value)||0;
            const diff = 100000 - (s1+s2+s3+s4);
            const el = document.getElementById('status-bar');
            if(s1+s2+s3+s4===0) { el.innerText="ç­‰å¾…è¾“å…¥..."; el.className="status-bar"; return false; }
            if(diff===0) { el.innerText="âœ… æ ¡éªŒé€šè¿‡"; el.className="status-bar status-ok"; return true; }
            else { el.innerText=`âŒ å·® ${diff}`; el.className="status-bar status-error"; return false; }
        }

        function submitMatch() {
            if(!checkSum()) { alert("åˆ†æ•°ä¸å¯¹"); return; }
            let res = [];
            for(let i=1; i<=4; i++) {
                let n=document.getElementById(`p${i}-name`).value.trim(), s=Number(document.getElementById(`p${i}-score`).value);
                if(!n || s%100!==0) { alert("ä¿¡æ¯æœ‰è¯¯"); return; }
                res.push({name:n, score:s});
            }
            res.sort((a,b)=>b.score-a.score);
            res.forEach((p,i) => {
                let pt = (p.score-30000)/1000 + RULE.uma[i] + (i===0?20:0);
                p.gamePt = Math.round(pt*10)/10; p.rank=i+1;
                if(!appData.players[p.name]) appData.players[p.name] = {pt:0, count:0};
                appData.players[p.name].pt = Math.round((appData.players[p.name].pt + p.gamePt)*10)/10;
                appData.players[p.name].count++;
                p.totalPtAfter = appData.players[p.name].pt;
            });
            appData.matches.push({id:appData.matches.length+1, timestamp:new Date().toISOString(), results:res});
            saveData(); updateUI(); showMatchPoster(res, appData.matches.length);
            resetInputs();
        }

        // --- Logic: Undo ---
        function undoLastMatch() {
            if(!appData.matches.length || !confirm("ç¡®å®šæ’¤é”€ä¸Šä¸€å±€ï¼Ÿ")) return;
            const m = appData.matches.pop();
            m.results.forEach(p => {
                if(appData.players[p.name]) {
                    appData.players[p.name].pt = Math.round((appData.players[p.name].pt - p.gamePt)*10)/10;
                    appData.players[p.name].count--;
                }
            });
            saveData(); updateUI(); alert("å·²æ’¤é”€");
        }

        // --- Logic: UI Update ---
        function updateUI() {
            const undoBtn = document.getElementById('undo-btn');
            undoBtn.style.display = appData.matches.length ? 'inline-block' : 'none';

            const tb = document.querySelector('#leaderboard-table tbody'); tb.innerHTML='';
            Object.entries(appData.players).sort((a,b)=>b[1].pt - a[1].pt).forEach((p,i) => {
                let tr = document.createElement('tr');
                tr.innerHTML = `<td style="color:${i<3?'var(--primary-gold)':'#888'};font-weight:${i<3?'bold':'normal'}">${i+1}</td>
                <td style="text-align:left;font-weight:bold">${p[0]}</td><td>${p[1].count}</td>
                <td class="${p[1].pt>=0?'score-plus':'score-minus'}" style="font-weight:bold">${p[1].pt>0?'+'+p[1].pt:p[1].pt}</td>`;
                tb.appendChild(tr);
            });

            const hb = document.querySelector('#history-table tbody'); hb.innerHTML='';
            [...appData.matches].reverse().forEach(m => {
                let r1 = m.results[0];
                let tr = document.createElement('tr'); tr.className='history-row'; tr.onclick=()=>toggleDetail(m.id);
                tr.innerHTML = `<td style="color:var(--primary-gold)">${m.id}</td><td style="font-weight:bold">${r1.name}</td>
                <td>${m.results[1].name}</td><td>${m.results[2].name}</td><td>${m.results[3].name}</td>`;
                hb.appendChild(tr);

                let dtr = document.createElement('tr'); dtr.className='history-detail-row'; dtr.id=`detail-${m.id}`;
                let dhtml = `<div class="detail-wrapper"><div class="detail-grid">`;
                m.results.forEach(p => {
                    let ptStr = p.gamePt>0?'+'+p.gamePt:p.gamePt;
                    dhtml += `<div class="detail-item"><span class="d-rank">${p.rank}</span><span class="d-name">${p.name}</span>
                    <span class="d-score">${p.score}</span><span class="d-pt" style="color:${p.gamePt>=0?'#ff4d4d':'#4dff88'}">${ptStr}</span></div>`;
                });
                dhtml += `</div><div style="text-align:center"><button class="btn-regenerate" onclick="regenerateMatch(${m.id})">ğŸ“¸ æŸ¥çœ‹æœ¬å±€æµ·æŠ¥</button></div></div>`;
                dtr.innerHTML = `<td colspan="5" style="padding:0;border:none">${dhtml}</td>`;
                hb.appendChild(dtr);
            });
        }
        
        function toggleDetail(id) {
            let row = document.getElementById(`detail-${id}`);
            let isShow = row.classList.contains('show');
            document.querySelectorAll('.history-detail-row').forEach(e=>e.classList.remove('show'));
            if(!isShow) row.classList.add('show');
        }
        function regenerateMatch(id) { const m = appData.matches.find(x=>x.id===id); if(m) showMatchPoster(m.results, m.id); }

        // --- Logic: Yakuman ---
        function generateCertificate() {
            const name = document.getElementById('y-name').value, hand = document.getElementById('y-hand').value;
            if(!name || !hand) { alert("ä¿¡æ¯ä¸å…¨"); return; }
            
            switchTab('yakuman');
            document.getElementById('match-poster-dom').style.display='none';
            document.getElementById('penalty-dom').style.display='none';
            document.getElementById('yakuman-cert-dom').style.display='flex';
            
            document.getElementById('cert-name').innerText = name;
            const now = new Date(); document.getElementById('cert-date').innerText = `${now.getFullYear()}.${now.getMonth()+1}.${now.getDate()}`;
            document.getElementById('cert-type').innerText = document.getElementById('y-type').value;
            document.getElementById('cert-yaku').innerText = document.getElementById('y-yaku').value;
            
            const cont = document.getElementById('cert-tiles-container'); cont.innerHTML='';
            const tiles = parseHand(hand);
            tiles.forEach(t => {
                let d = document.createElement('div'); d.className=`real-tile ${t.cls}`; d.innerText=t.char; cont.appendChild(d);
            });
            openModal();
        }

        function parseHand(str) {
            let tiles=[], regex=/(\d+)([mps])/g, match, consumed=str;
            while ((match = regex.exec(str)) !== null) {
                let uMap={'m':['ğŸ€‡','ğŸ€ˆ','ğŸ€‰','ğŸ€Š','ğŸ€‹','ğŸ€Œ','ğŸ€','ğŸ€','ğŸ€'],'p':['ğŸ€™','ğŸ€š','ğŸ€›','ğŸ€œ','ğŸ€','ğŸ€','ğŸ€Ÿ','ğŸ€ ','ğŸ€¡'],'s':['ğŸ€','ğŸ€‘','ğŸ€’','ğŸ€“','ğŸ€”','ğŸ€•','ğŸ€–','ğŸ€—','ğŸ€˜']};
                let cMap={'m':'man','p':'pin','s':'sou'};
                match[1].split('').forEach(n=>tiles.push({char:uMap[match[2]][n-1], cls:cMap[match[2]]}));
                consumed=consumed.replace(match[0],'');
            }
            let hMap={'e':'ğŸ€€','s':'ğŸ€','w':'ğŸ€‚','n':'ğŸ€ƒ','P':'ğŸ€†','b':'ğŸ€†','p':'ğŸ€†','f':'ğŸ€…','c':'ğŸ€„'};
            let cMap={'e':'honor','s':'honor','w':'honor','n':'honor','P':'honor','b':'honor','p':'honor','f':'green','c':'red'};
            for(let c of consumed) if(hMap[c]) tiles.push({char:hMap[c], cls:cMap[c]});
            return tiles;
        }

        // --- Logic: Penalty ---
        function generatePenalty() {
            const name = document.getElementById('pen-name').value;
            const reason = document.getElementById('pen-reason').value;
            const result = document.getElementById('pen-result').value;

            if(!name || !reason || !result) { alert("è¯·å¡«å†™å®Œæ•´å¤„ç½šä¿¡æ¯"); return; }

            switchTab('penalty');
            document.getElementById('match-poster-dom').style.display='none';
            document.getElementById('yakuman-cert-dom').style.display='none';
            document.getElementById('penalty-dom').style.display='block';

            document.getElementById('pen-dom-name').innerText = name;
            document.getElementById('pen-dom-reason').innerText = reason;
            document.getElementById('pen-dom-result').innerText = result;
            
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            document.getElementById('pen-dom-time').innerText = "æ‰§è¡Œæ—¶é—´: " + timeStr;

            openModal();
        }

        // --- Common ---
        function showMatchPoster(results, id) {
            document.getElementById('match-poster-dom').style.display='block';
            document.getElementById('yakuman-cert-dom').style.display='none';
            document.getElementById('penalty-dom').style.display='none';
            
            document.getElementById('share-game-id').innerText = `GAME #${String(id).padStart(2,'0')}`;
            const now = new Date(); document.getElementById('share-date').innerText = `${now.getFullYear()}.${now.getMonth()+1}.${now.getDate()}`;
            const cont = document.getElementById('share-content'); cont.innerHTML='';
            results.forEach(p => {
                let div = document.createElement('div'); div.className=`sc-row r${p.rank}`;
                let ptStr = p.gamePt>0?'+'+p.gamePt.toFixed(1):p.gamePt.toFixed(1);
                let tot = p.totalPtAfter!==undefined?(p.totalPtAfter>0?'+'+p.totalPtAfter.toFixed(1):p.totalPtAfter.toFixed(1)):'-';
                div.innerHTML = `<div class="sc-rank-badge">${p.rank}</div><div class="sc-name">${p.name}</div>
                <div class="sc-val sc-score">${p.score}</div><div class="sc-val sc-pt ${p.gamePt>=0?'val-pos':'val-neg'}">${ptStr}</div>
                <div class="sc-val sc-total">${tot}</div>`;
                cont.appendChild(div);
            });
            openModal();
        }

        function openModal() {
            document.getElementById('share-modal').style.display='flex';
            document.getElementById('capture-target').style.display='block';
            document.getElementById('img-preview-area').style.display='none';
            document.getElementById('modal-controls').style.display='flex';
        }
        function closeModal() { document.getElementById('share-modal').style.display='none'; }
        
        function downloadImage() {
            const btn = document.querySelector(".btn-download"); btn.innerText = "â³ æ¸²æŸ“ä¸­...";
            let target;
            if(document.getElementById('match-poster-dom').style.display === 'block') target = document.getElementById('match-poster-dom');
            else if(document.getElementById('yakuman-cert-dom').style.display === 'flex') target = document.getElementById('yakuman-cert-dom');
            else target = document.getElementById('penalty-dom');

            html2canvas(target, {backgroundColor:null, scale:3}).then(canvas => {
                btn.innerText = "ğŸ“¸ ä¿å­˜ä¸ºå›¾ç‰‡";
                const imgData = canvas.toDataURL("image/png");
                const prev = document.getElementById('img-preview-area'); 
                prev.innerHTML = '<div class="save-tip">âœ… ç”ŸæˆæˆåŠŸï¼è¯·é•¿æŒ‰ä¸‹æ–¹å›¾ç‰‡ä¿å­˜</div>';
                const img = document.createElement('img'); img.src = imgData; prev.appendChild(img);
                document.getElementById('capture-target').style.display='none';
                document.getElementById('modal-controls').style.display='none';
                prev.style.display='block';
                let cls = document.createElement('button'); cls.innerText="å…³é—­"; cls.className="btn-close"; cls.onclick=closeModal; cls.style.marginTop="20px"; prev.appendChild(cls);
            });
        }

        function resetInputs() {
             document.querySelectorAll('input').forEach(i=>i.value='');
             document.querySelectorAll('select').forEach(s=>s.selectedIndex=0);
             checkSum();
        }
        function clearAllData() { if(confirm("ç¡®è®¤æ¸…ç©ºï¼Ÿ")) { localStorage.removeItem('801_league_data_v7'); appData={matches:[],players:{}}; updateUI(); } }
    </script>
</body>
</html>
